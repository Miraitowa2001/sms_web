# 筛选功能使用说明

## 功能概述

本系统已为短信记录、通话记录和消息日志添加了完整的筛选功能。

## 短信记录筛选

**可用的筛选条件:**
- 📱 **号码搜索**: 搜索特定的对方号码
- 📥 **方向筛选**: 
  - 全部方向
  - 收到
  - 发出
- 📅 **日期范围**: 
  - 开始日期
  - 结束日期

**使用方法:**
1. 打开"短信记录"标签页
2. 在搜索框中输入筛选条件
3. 点击"搜索"按钮
4. 点击"清空"按钮重置所有筛选条件

## 通话记录筛选

**可用的筛选条件:**
- 📱 **号码搜索**: 搜索特定的对方号码
- 📞 **通话分类**: 
  - 全部类型
  - 来电(已接通)
  - 去电
  - 未接
- 📅 **日期范围**: 
  - 开始日期
  - 结束日期

**通话记录包含的信息:**
- **消息类型**: 显示详细的通话状态(601-来电振铃、602-来电接通、603-对方挂断等)
- **通话分类**: 来电/去电/未接的简化分类
- **对方号码**: 通话号码
- **时间**: 通话发生的时间
- **时长**: 通话持续时间(秒)

**消息类型说明:**
- 601: 📳 来电振铃
- 602: ✅ 来电接通
- 603: 📴 对方挂断
- 620: 📲 去电拨号
- 621: 📳 对方振铃
- 622: ✅ 去电接通
- 623: 📴 去电挂断
- 641: 🔢 本地按键
- 642: 🔢 远程按键

**使用方法:**
1. 打开"通话记录"标签页
2. 在搜索框中输入筛选条件
3. 点击"搜索"按钮
4. 点击"清空"按钮重置所有筛选条件

**注意**: 
- 通话记录会记录所有通话状态消息(振铃、接通、挂断等),而不只是通话结束的记录
- 这样可以完整地追踪每个通话的全过程

## 消息日志筛选

**可用的筛选条件:**
- 📋 **消息类型**: 
  - 全部消息类型
  - **按大类筛选**:
    - 📡 所有联网消息 (100-102)
    - 📱 所有SIM卡消息 (202-209)
    - 💬 所有短信消息 (501-502)
    - 📞 所有电话消息 (601-642)
    - 🎛️ 所有电话控制 (681-689)
    - ⚙️ 所有命令应答 (401-402)
    - 🔌 通讯模组消息 (301)
  - **按具体类型筛选**:
    - 联网消息: 100-WIFI已联网, 101-卡槽1已联网, 102-卡槽2已联网
    - SIM卡消息: 202-基站注册中, 203-ID已获取, 204-已就绪, 205-已弹出, 209-异常
    - 短信消息: 501-新短信, 502-外发成功
    - 电话消息: 601-来电振铃, 602-来电接通, 603-对方挂断, 620-去电拨号中, 621-对方振铃中, 622-去电接通, 623-去电挂断, 641-本地按键, 642-远程按键
    - 电话控制: 681-外呼成功, 682-外呼失败, 684-接听成功, 685-接听失败, 687-TTS成功, 688-TTS失败, 689-TTS结束
    - 其他消息: 301-通讯模组错误, 401-命令已收到, 402-命令已处理
- 📅 **日期范围**: 
  - 开始日期
  - 结束日期

**使用方法:**
1. 打开"消息日志"标签页
2. 选择消息类型(可选择大类或具体类型)和日期范围
3. 点击"搜索"按钮
4. 点击"清空"按钮重置所有筛选条件

## API接口说明

### 短信记录 API
```
GET /api/sms?phoneNum=xxx&direction=in&dateStart=2025-01-01&dateEnd=2025-12-31
```

**参数说明:**
- `phoneNum`: 号码搜索(模糊匹配)
- `direction`: 方向筛选(in/out)
- `dateStart`: 开始日期(YYYY-MM-DD)
- `dateEnd`: 结束日期(YYYY-MM-DD)
- `page`: 页码(默认1)
- `limit`: 每页数量(默认50)

### 通话记录 API
```
GET /api/calls?phoneNum=xxx&callType=incoming&dateStart=2025-01-01&dateEnd=2025-12-31
```

**参数说明:**
- `phoneNum`: 号码搜索(模糊匹配)
- `callType`: 通话类型(incoming/outgoing/missed)
- `dateStart`: 开始日期(YYYY-MM-DD)
- `dateEnd`: 结束日期(YYYY-MM-DD)
- `page`: 页码(默认1)
- `limit`: 每页数量(默认50)

### 消息日志 API
```
GET /api/messages?msgType=501&dateStart=2025-01-01&dateEnd=2025-12-31
GET /api/messages?msgCategory=call&dateStart=2025-01-01
```

**参数说明:**
- `msgType`: 具体消息类型代码(100、501、603等)
- `msgCategory`: 消息大类(network、sim、sms、call、call_ctrl、command、module)
- `dateStart`: 开始日期(YYYY-MM-DD)
- `dateEnd`: 结束日期(YYYY-MM-DD)
- `page`: 页码(默认1)
- `limit`: 每页数量(默认100)

**消息大类说明:**
- `network`: 联网消息(100-102)
- `sim`: SIM卡消息(202-209)
- `sms`: 短信消息(501-502)
- `call`: 电话消息(601-642)
- `call_ctrl`: 电话控制应答(681-689)
- `command`: 命令应答(401-402)
- `module`: 通讯模组(301)

**消息类型代码说明:**
- **100-102**: 联网消息(WIFI、卡槽1/2联网)
- **202-209**: SIM卡消息(注册、就绪、弹出、异常等)
- **301**: 通讯模组错误
- **401-402**: 命令应答
- **501-502**: 短信消息(新短信、外发成功)
- **601-603, 620-623, 641-642**: 电话消息(来电、去电、按键等)
- **681-689**: 电话控制应答(外呼、接听、TTS等)

## 日期格式说明

- 日期格式统一为: `YYYY-MM-DD`
- 例如: `2025-12-08`
- 日期比较基于北京时间
- 如果只设置开始日期,则查询该日期之后的所有记录
- 如果只设置结束日期,则查询该日期之前的所有记录
- 同时设置开始和结束日期,则查询该日期范围内的记录

## 移动端优化

- 所有筛选控件在移动端自动换行显示
- 日期选择器在移动端使用原生控件
- 搜索框在移动端自动填满一行
- 按钮大小在移动端自动调整

## 注意事项

1. 日期筛选使用数据库中的时间字段,短信使用`sms_time`,通话使用`start_time`
2. 如果记录中没有时间字段,将使用`created_at`字段作为备选
3. 筛选结果最多显示100条记录(可通过API的limit参数调整)
4. 导出功能会导出当前筛选条件下的所有记录
5. 批量删除功能只对选中的记录生效,不受筛选条件影响
